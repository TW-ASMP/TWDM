---
$schema: http://json-schema.org/draft-07/schema#
title: Job Plan
$id: https://raw.githubusercontent.com/TW-ASMP/TWmaximoConfig/main/1-Schemas/A-entity_record_schema/32_job_plan.yml
description: |
  A job plan is the the lowest level of work description to contain the full planning specifications. 
type: object 
 
properties:

  ID:
    
    description: is a read-only, unique, and permanent ID, generated by the system, to identify the job plan record.
    type: string
    $comment: >
      - This is akin to the activity procedure ID, such as FISELS201, in Avantis, but it would not contain any content.

  #================

  title:

    description: is a description of the activity specified in the job plan.
    type: string
     
  
  #================================
  # Applicability Parameters  
  #================================

  targets_asset_classes:

    description: identifies the asset classes on which the activity specified in this job plan can be done.
    type:
      oneOf:
      - type: NULL
      - type: array
        item:
          $ref: "../B-entity_class_object_schema/01_asset_item_tool_class.yml"

  #================

  specific_to_role_classes:

    description: identifies the role classes - more specifically, the assets installed in these classes of roles - that this job plan is customized.
    type:
      oneOf:
      - type: NULL
      - type: array
        item:
          $ref: "../B-entity_class_object_schema/02_role_class.yml"
    $comment: >
      Examples of a role class include tie-breaker or back-wash pump. 

  #================

  specific_to_operational_units:

    description: identifies the Toronto Water site(s) for which the job plan is specifically customized.
    type:
      oneOf:
      - type: NULL
      - type: array
        item:
          $ref: "../B-entity_class_object_schema/site"
    $comment: >
      Examples of operational group
        TAB - Ashbridges Bay Wastewater Treatment Plants
        COL - Waste and Storm Water Collection
       
  #================

  specific_to_roles:

    description: identifies the asset roles for which the job plan is specifically customized.
    TW_rule: >
      [] TODO against possible conflict between site and role, make to_site and to_role mutually exclusive. 
  
  #================

  specific_to_commercial_products: 
  
    description: identifies the the commercial products for which the job plan is specifically written/customized.
    type:
      oneOf:
      - type: NULL
      - type: array
        item:
          $ref: "../A-entity_record_schema/05_item_master.yml"
    TW_rule: >
      - name: Valid Commercial Product Item
        id: Ek3iYk5lbe
        type: [validation]
        description: |
          [] only allow a reference to an item that represents a commercial product
          
  #================

  is_derived_from:

    oneOf:
      - type: NULL
      - $ref: "./32_job_plan.yml"
    integration: true
    $comment: This field is likely updated by an integrated solution that manages the job plan definitions and relations between generic and specific job plans.

  #================

  failure_modes:

    description: identifies the functional failure mode ID, with respect to a specific asset role, mitigated by the work specified in this job plan.
    oneOf:
      - type: NULL
      - type: array
        item: 
          type: string
    integration: true
    $comment: >
      - For the 2026-27 implementation, this data field will start-out as a free-text. In the future, the value will come from a solution such as OnePM.

  #================

  activity_steps:

    description: is a single body of text outlining the sequential steps to complete the activity
    type: string
    $comment: >
      Example: 
        []
      In the future, each step can be represented as a task.

  #================

  activity_type:

    description: indicates the type of activity that specified in the job plan
    $ref: "../B-entity_class_object_schema/32_discrete_activity_class.yml"
  
  #================

  estimated_wrench_time:

    description: is the estimated time to complete the activity in the job plan
    $ref: "./101_common_definitions.yml#/definitions/interval_definition"

#========================================
# Resource
#========================================
  
  tool_requirement:
  
    description: identifies the tools required to complete the work.
    oneOf:
      - type: NULL
      - type: array
        items:
          - $ref: "./101_common_definitions.yml#/definitions/tool_requirement_definition"
    $comment: the tools can be stocked or un-stocked. 

  #================

  parts_and_material_requirement:
    
    description: identifies the parts and material required to complete the work. 
    oneOf:
      - type: NULL
      - type: array
        items:
          - $ref: "./101_common_definitions.yml#/definitions/item_requirement_definition"

  #================
  
  services_requirement:

    description: identifies (contracted) service needed to complete the work.
    oneOf:
      - type: NULL
      - type: array
        items:
          - $ref: "./101_common_definitions.yml#/definitions/service_requirement_definition"

  #================
  
  trades_requirement:
  
    oneOf:
    - type: NULL
    - type: array
      items:
        - $ref: "./101_common_definitions.yml#/definitions/trade_requirement_definition"
    description: identifies the trade and qualifications needed to complete the work.

#========================================
# Related Activities
#========================================

  must_be_preceded_by:
    
    oneOf:
    - type: NULL
    - type: array
      items:
        - $ref: "./32_job_plan.yml"
    description: identifies activities (specified in other job plans) that must be performed in the same work order before the activity specified in this PM can be performed..


  must_be_followed_by:
    
    oneOf:
    - type: NULL
    - type: array
      items:
        - $ref: "./32_job_plan.yml"
    description: identifies activities (specified in other job plans) that must be performed in the same work order after the activity specified in this PM can be performed.

#========================================
# Trigger Condition Group
#========================================
  
  trigger_every:

    oneOf:
      - type: NULL
      - $ref: "./101_common_definitions.yml#/definitions/interval_definition"
    description: indicate that the activity in the job plan must be performed at a frequency required by some authority. If theres is no binding requirement, this property should be left empty (NULL). 

  #================

  trigger_in_relation_to_event:

    oneOf:
      - type: object
      - type: NULL
    
    properties:
    
      relation_to_event:

        type: string
        enum:
          - before
          - during
          - after
          - at the start of
          - at the end of
    
      the_event:

        description: a free-text description of a event or process, such as "an  elevator failure".
        type: string
    

#========================================
# Compliance Group
#========================================
  
  compliance_requirement:
    
    description: identifies the compliance object, 
    integration: semantic layer
    oneOf: 
      - type: NULL
      - type: array
        items:
          - $ref: "#/definitions/compliance_requirement"
          
  #================
  
  job_plan_compliance_class:
    
    description: indicates the level of compliance, with legislative being the top 
    $ref: "./101_common_definitions.yml#/definitions/compliance_class"

  #====================

  mitigates_safety_risk_to_staff:

    oneOf: 
    - type: NULL
    - type: string
    enum:
      - yes
      - no
      - unspecified

  #====================
  
  mitigates_safety_or_health_risk_to_public:

    oneOf: 
    - type: NULL
    - type: string
    enum:
      - yes
      - no
      - unspecified
  
  #==================== 

  mitigates_environmental_risk:

    oneOf: 
    - type: NULL
    - type: string
    enum:
      - yes
      - no
      - unspecified

  #====================
  
  safe_work_plan:

    description: identifies a safety work plan by a permanent URL to the document (e.g., corporate Safe Procedure or Toronto Water Safe Operating Procedures)
    oneOf: 
      - type: NULL
      - type: array
        items:  #URL strings
          - type: string

#========================================
# Require Information Data Submission Group
#========================================

  required_file_attachments: #this mus be an URL for controlled document
  
  required_system_forms:

  required_meter_readings:

##########################################################
# LOCAL OBJECT DEFINITIONS
##########################################################

definitions:

  compliance_requirement:
    
    requirement_name:
    type: string
    $comment: |
      For example, 'ANSI Z358.1-2014 on weekly inspection of self-contained emergency wash equipment'.

    #-------

    requirement_detail:
      type: string
      description: provides all relevant descriptions
      $comment: |
        The following is an example of the requirement detail text for a compliance requirement.
          
          applicable_asset_class:
            - emergency eye-wash

          requirement_source(s):
            - ANSI Z358.1-2014 / Emergency Eyewash & Shower Standard / 4 Emergency Showers / 4.6 Maintenance and Training
              ...
            - ANSI Z358.1-2014 / Emergency Eyewash & Shower Standard / 4 Emergency Showers / 4.5 Installation
              ...
          
          source_content_guide:
            - ANSI Z358.1-2014 4.6 states the requirement to check that shower still meets standards
            - ANSI Z358.1-2014 4.5 states the standards to apply for ht check
          
          perform_every:
            - year`
          
    #-------

    compliance_class:
      
      $ref: "./101_common_definitions.yml#/definitions/compliance_class"
      