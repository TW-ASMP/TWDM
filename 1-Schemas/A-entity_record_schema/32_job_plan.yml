---
$schema: http://json-schema.org/draft-07/schema#
title: Job Plan
$id: https://raw.githubusercontent.com/TW-ASMP/TWDM/main/1-Schemas/A-entity_record_schema/32_job_plan.yml
description: |
  A job plan is the the lowest level of work description to contain the full planning specifications. 
type: object 
 
properties:

  ID:
    description: a read-only, unique, and permanent ID, generated by the system, to identify the job plan record.
    type: string

  name:
    description: a description of the activity specified in the job plan.
    type: string

  discrete_activity_classification:
    description: indicates the type of activity that specified in the job plan
    $ref: "../B-entity_class_object_schema/32_discrete_activity_class.yml"
    $comment: this could also be called the activity classification
  
  
  # JOB PLAN APPLICABILITY NOTES

  specific_to_asset_classes:
    description: identifies the asset classes on which the activity specified in this job plan can be done.
    type:
      oneOf:
      - type: null
      - type: array
        items:
          $ref: "../B-entity_class_object_schema/01_asset_item_tool_class.yml"

  specific_to_asset_functional-location_classes:
    description: identifies the functional-location classes - more specifically, the assets installed in these functional-locations - for which this job plan is customized.
    type:
      oneOf:
      - type: null
      - type: array
        items:
          $ref: "../B-entity_class_object_schema/02_functional-location_classification.md"
    $comment: >
      Examples of a functional-location class include the tie-breaker and effluent turbidity meter functional-location class. 

  specific_to_operational_units:
    description: identifies the Toronto Water site(s), defined as a org-chart group in this schema, for which the job plan is specifically customized.
    type:
      oneOf:
      - type: null
      - type: array
        items:
          $ref: "../A-entity_record_schema/04_org_class.yml"
    $comment: >
      Examples of operational group include
        TAB - Ashbridges Bay Wastewater Treatment Plants
        COL - Waste and Storm Water Collection
    RULE_SPEC: >
      - name: job plan's specific_to_operational_units property must be an unit level org-chart group
        spec_ID: 01JD2V5X97J1Y45JWDW4SV1FJ4
        type: [constraint_or_validation]
        specification: |
          Given an job plan, JP_x, all values of JP_x.specific_to_operational_units must be
            - an org-chart group, and
            - whose .class = unit (a subclass of Group in the City)

  specific_to_asset_functional-locations:
    description: identifies the functional-locations for which the job plan is specifically customized.
    type:
      oneOf:
      - type: null
      - type: array
        items:
          $ref: "../A-entity_record_schema/02_functional-location.yml"

  specific_to_commercial_products: 
    description: identifies the the commercial products for which the job plan is specifically written/customized.
    type:
      oneOf:
      - type: null
      - type: array
        items:
          $ref: "../A-entity_record_schema/05_item_master.yml"
    RULE_SPEC: >
      - name: Valid Commercial Product Item reference in a Job Plan
        spec_ID: 01JD2V5X97J1Y45JWDW4SV1FJ4
        type: [constraint_or_validation]
        specification: |
           Given an job plan, JP_x, all values of JP_x.specific_to_commercial_products must be
            - a item master record, and
            - whose .generic_or_specific_product = "specific commercial product"
          
# RECORD PROVENANCE

  is_derived_from:
    description: identifies the job plan from which the present job plan specification was based on.
    oneOf:
      - type: null
      - $ref: "./32_job_plan.yml"
    integration: [PM library]
  
  failure_codes:  
      description: denotes a physical-based failure condition (e.g., shaft misalignment). 
      oneOf:
        - type: null
        - type: array
          items:
            $ref: "./00_common_definitions.yml#/definitions/failure_code"

  RCM_failure_modes:
    description: identifies the functional failure mode ID, with respect to a specific functional-location, mitigated by the work specified in this job plan.
    oneOf:
      - type: null
      - type: array
        items: 
          type: string
    integration: [PM Library]
    $comment: >
      - For the 2026-27 implementation, this data field will start-out as a free-text. In the future, the value will come from a solution such as OnePM.

# PROCEDURE

  work_description:
    description: is a single body of text outlining the sequential steps to complete the activity
    type: string
    $comment: >
      Example: 
        1) Ensure you have operational approval before performing this task.
        2) Follow Lock-out and Tag-out process before starting this task.
        3) Drain the oil from the gearbox.
        4) Install 25 Litres of UCON 220 ( food grade) oil.
        5) Remove Lock-out and Tag-out and check operation.
        6) Inform operations that the task as assigned is completed.

  requires_shut_down:
    description:
    type: boolean

# RESOURCE REQUIREMENTS

  estimated_duration:
    description: is the estimated time to complete the activity in the job plan
    $ref: "./00_common_definitions.yml#/definitions/frequency_interval_definition"
  
  parts_or_material_requirements:
    description: identifies the parts and material required to complete the work. 
    oneOf:
      - type: null
      - type: array
        items:
          $ref: "./00_common_definitions.yml#/definitions/item_requirement_definition"
  
  tool_requirements:
    description: identifies the tools required to complete the work.
    oneOf:
      - type: null
      - type: array
        items:
          $ref: "./00_common_definitions.yml#/definitions/tool_requirements_definition"

  skill_and_trade_requirements:
    description: identifies the trades and qualifications of each trade needed to complete the work.
    oneOf:
    - type: null
    - type: array
      items:
        $ref: "./00_common_definitions.yml#/definitions/trade_requirement_definition"

  service_requirements:
    description: identifies (contracted) service needed to complete the work.
    oneOf:
      - type: null
      - type: array
        items:
          $ref: "./00_common_definitions.yml#/definitions/service_requirement_definition"

# RELATED ACTIVITIES

  must_be_preceded_by:
    description: identifies activities (specified in other job plans) that must be performed in the same work order before the activity specified in this PM can be performed.
    oneOf:
    - type: null
    - type: array
      items:
        $ref: "./32_job_plan.yml"
    dev_note:
      P3_MVP: false 
      P1_label: 
      DB: 

  must_be_followed_by:
    description: identifies activities (specified in other job plans) that must be performed in the same work order after the activity specified in this PM can be performed.
    oneOf:
    - type: null
    - type: array
      items:
        $ref: "./32_job_plan.yml"
    dev_note:
      P3_MVP: false 
      P1_label: 
      DB: 

# WORK TRIGGER CONDITION NOTES

  time-based_frequency:
    oneOf:
      - type: null
      - $ref: "./00_common_definitions.yml#/definitions/frequency_interval_definition"

  meter-based_frequency:
    oneOf:
      - type: null
      - $ref: "./00_common_definitions.yml#/definitions/meter_condition_definition"

  description_of_event-based_trigger:
    oneOf:
      - type: null
      - type: object
        properties:
          relation_to_event:
            type: string  
            enum:
              - before
              - during
              - after
              - at the start of
              - at the end of
          description_of_event:
            description: a free-text description of a event or process, such as "an  elevator failure".
            type: string
    
  notes_on_trigger_condition:
    description: free-text description on the additional trigger conditions
    oneOf:
      - type: null
      - type: string

# COMPLIANCE INFORMATION

  compliance_requirement:
    description: identifies the compliance requirement object
    integration: [data hub]
    oneOf: 
      - type: null
      - type: array
        items:
          $ref: "./00_common_definitions.yml#/definitions/compliance_requirement"
          
  compliance_class:
    description: indicates the level of compliance, with legislative being the top class
    $ref: "./00_common_definitions.yml#/definitions/compliance_class"


  safe_work_plan_link:
    description: identifies a safety work plan by a permanent URL to the document (e.g., corporate Safe Procedure or Toronto Water Safe Operating Procedures)
    oneOf: 
      - type: null
      - type: array
        items:  #URL strings
          type: string

# COMMON RECORD PROPERTIES

  duplicate_record_of:
    P3_MVP: true
    $ref: "./00_common_definitions.yml#/definitions/duplicate_record_def"

  record_retirement_information:
    P3_MVP: true
    $ref: "./00_common_definitions.yml#/definitions/record_retirement_def"


#############################################################
# RULES
#############################################################