$schema: http://json-schema.org/draft-07/schema#
title: Work Request
$id: https://raw.githubusercontent.com/TW-ASMP/TWmaximoConfig/main/1-Schemas/A-entity_record_schema/34_work_request_andOr_issue_found.yml

$comment: In this design, the work request doubles as a failure report.

properties:

  ID:
 
    description: is a read-only unique iD, generated by the system, to uniquely identify the record. 
    type: string

  issue_only:
 
    description: indicates whether the record is being used to track an issue, without a proposal of work to address the issue.  
    type: boolean

  #================

  work_order_reference:

    description: identifies the work order this work request is following-up on - likely because a failure was found while the work was being performed. 
    read_only: true
    oneOf:
      - type: null
      - $ref: "../A-entity_record_schema/35_work_order.yml"
  
  # OBJECTS:
  #================================

  asset_in_role:
  
  #================
  
  asset:
  
  #================
  
  service_address !!: 

  #================================
  # ISSUE DETAIL
  #================================

  description_of_issue:

    description: is a free-text description of the observable aspects of (what is perceived to be) a single issue.
    guide_text: Only enter the *observable* aspects (or failure conditions directly inferrable from the observable aspects) of the issue. 
    type: string

  #================

  problem_codes:

    description: is what is also known as a common symptom code (e.g., making noise, cannot start, not running).
    oneOf:
      - type: boolean
      - type: array
        items:
          $ref: "#/definitions/issue_code"
    $comment: The user should be allowed to enter multiple failure codes related to a failure  []todo - anyone can problem a draft issue code
  
  #================
  
  failure_codes:

    description: is a more definitive indication of failure condition (e.g., shaft-misalignment). 
    oneOf:
      - type: boolean
      - type: array
        items:
          $ref: "#/definitions/issue_code"
    $comment: The user should be allowed to enter multiple failure codes related to a failure

  #================

  found_asset_offline_due_to_this_failure:

    description: indicates whether the asset was offline, because of the failure 
    type: boolean

  #================

  took_asset_offline_due_to_this_failure:

    description: indicates whether the asset had to be taken offline, because of the failure 
    type: boolean
  
  #================================
  # WORK REQUEST DETAIL   
  #================================

  request_title:

    description:
    oneOf:
      - type: null
      - type: string
  
  #================
  
  supports_capital_project:
    
    description:
    oneOf:
      - type: null
      - $ref: "../A-entity_record_schema/35_work_order.yml"

  #================

  work_type:

    description: 
    $ref: "../B-entity_class_object_schema/33_work_type.yml"
    # []rule: if failure is reported, then work type must either be investigative or repair
    
  #================

  work_description:

  #================

  photographs:

  #================

  priority:
  
  #================
  
  start_no_later_than:

  #================
  
  finish_no_later_than:


###############################
# MINOR OBJECT DEFINITIONS
###############################

definitions:

  issue_code:
    
    type: object
    properties:
      name:
        type: string
      #-----------------
      type_of_code:
        type: string
        enum:
          - problem
          - failure
      #-----------------
      description:
        type: string
      #-----------------
      status:
        type: string
        enum:
          - draft
          - approved